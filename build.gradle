plugins {
    id 'java'
    id 'org.checkerframework' version '0.6.20'
}

apply plugin: 'org.checkerframework'

group 'org.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.0'
}

test {
    useJUnitPlatform()
}

checkerFramework {
    checkers = [
            'org.checkerframework.checker.nullness.NullnessChecker',
            'org.checkerframework.common.value.ValueChecker',
    ]
    extraJavacArgs = [
        '-Ainfer=ajava',
        '-Awarns',
        '-AshowPrefixInWarningMessages',
        '-Aajava=$WPITEMPDIR',
    ]
}

// To use a locally-built Checker Framework, run gradle with "-PcfLocal".
if (project.hasProperty("cfLocal")) {
    def cfHome = String.valueOf(System.getenv("CHECKERFRAMEWORK"))
    dependencies {
        compileOnly files(cfHome + "/checker/dist/checker-qual.jar")
        testCompileOnly files(cfHome + "/checker/dist/checker-qual.jar")
        checkerFramework files(cfHome + "/checker/dist/checker.jar")
    }
}